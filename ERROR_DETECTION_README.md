# 🔍 سیستم تشخیص خطا و گزارش‌دهی ربات

این سیستم جامع برای تشخیص، تحلیل و گزارش‌دهی خطاهای ربات طراحی شده است.

## ✨ ویژگی‌های اصلی

### 🚨 تشخیص خطاهای مختلف
- **ImportError**: پکیج‌های نصب نشده
- **FileNotFoundError**: فایل‌های مفقود
- **PermissionError**: مشکلات دسترسی
- **AttributeError**: متغیرهای نامعتبر
- **NetworkError**: مشکلات شبکه
- **DatabaseError**: مشکلات پایگاه داده

### 📋 بررسی محیط سیستم
- بررسی وجود فایل‌های ضروری (.env, config.py)
- بررسی نصب پکیج‌های مورد نیاز
- بررسی دسترسی FFmpeg
- بررسی دسترسی‌های نوشتن
- بررسی اطلاعات سیستم

### 📊 گزارش‌دهی تفصیلی
- گزارش متنی کامل در `logs/crash_report.log`
- گزارش JSON تفصیلی در `logs/detailed_error_report.json`
- نمایش پیام‌های واضح در کنسول
- ارائه راه‌حل‌های پیشنهادی

## 🚀 نحوه استفاده

### راه‌اندازی خودکار
سیستم به طور خودکار در `bot.py` فعال می‌شود:

```python
from error_detector import setup_crash_handler, quick_environment_check

# تنظیم هندلر کرش سراسری
setup_crash_handler()

# بررسی سریع محیط
if not quick_environment_check():
    print("مشکلات حیاتی شناسایی شد!")
```

### استفاده دستی
```python
from error_detector import ErrorDetector

detector = ErrorDetector()

# بررسی محیط
env_check = detector.check_environment()

# تحلیل خطا
try:
    # کد شما
    pass
except Exception as e:
    analysis = detector.analyze_exception(type(e), e, e.__traceback__)
    report = detector.generate_crash_report(type(e), e, e.__traceback__)
```

## 📁 فایل‌های تولیدی

### `logs/crash_report.log`
گزارش متنی کامل شامل:
- اطلاعات سیستم
- جزئیات خطا
- مکان دقیق خطا
- راه‌حل‌های پیشنهادی
- مشکلات محیط

### `logs/detailed_error_report.json`
گزارش JSON تفصیلی شامل:
- timestamp دقیق
- اطلاعات کامل سیستم
- تحلیل کامل خطا
- لیست مشکلات محیط

### `logs/bot.log`
لاگ عادی ربات شامل:
- فعالیت‌های عادی
- خطاهای ثبت شده
- اطلاعات دیباگ

## 🔧 پیکربندی

### تنظیم دایرکتوری لاگ
```python
detector = ErrorDetector(log_dir="./custom_logs")
```

### سطح لاگینگ
سیستم از سطح ERROR برای خطاهای کرش استفاده می‌کند.

## 🎯 مثال‌های خطاهای شناسایی شده

### خطای پکیج نصب نشده
```
❌ [HIGH] پکیج‌های مورد نیاز نصب نشده: pyrogram, python-dotenv
   راه‌حل: دستور pip install -r requirements.txt را اجرا کنید
```

### خطای فایل مفقود
```
❌ [CRITICAL] فایل .env یافت نشد
   راه‌حل: فایل .env را ایجاد کنید و متغیرهای محیطی مورد نیاز را تنظیم کنید
```

### خطای دسترسی
```
❌ [HIGH] عدم دسترسی نوشتن در دایرکتوری ./logs
   راه‌حل: دسترسی‌های فایل سیستم را بررسی کنید
```

## 🛠️ عیب‌یابی

### اگر سیستم تشخیص خطا کار نمی‌کند:
1. مطمئن شوید `error_detector.py` در دایرکتوری اصلی وجود دارد
2. دسترسی نوشتن در دایرکتوری `logs/` را بررسی کنید
3. نسخه Python را بررسی کنید (3.7+ مورد نیاز)

### اگر گزارش‌ها تولید نمی‌شوند:
1. دایرکتوری `logs/` را دستی ایجاد کنید
2. دسترسی‌های فایل سیستم را بررسی کنید
3. فضای خالی دیسک را چک کنید

## 📞 پشتیبانی

در صورت بروز مشکل:
1. فایل‌های لاگ را بررسی کنید
2. گزارش JSON تفصیلی را مطالعه کنید
3. راه‌حل‌های پیشنهادی را اجرا کنید

---

**نکته**: این سیستم به طور خودکار فعال است و نیازی به تنظیم اضافی ندارد. در صورت کرش ربات، گزارش‌های تفصیلی در دایرکتوری `logs/` ایجاد می‌شوند.